---
export interface Heading {
	depth: number;
	slug: string;
	text: string;
	subheadings: Heading[];
}

interface Props {
	heading: Heading;
}

const { heading } = Astro.props;
---

<li is="toc-heading">
	<a
		href={"#" + heading.slug}
		class:list={[
			"block rounded-md px-2 -mx-2 py-1 text-stone-300 text-sm leading-6 border-l-2 border-transparent transition-colors hover:text-stone-200 hover:bg-stone-800/40 hover:border-stone-600/70",
			{
				"font-medium": heading.depth <= 2,
			},
		]}
	>
		{heading.text}
	</a>

	{
		heading.subheadings.length > 0 && (
			<ol class="pl-4 mt-1 space-y-1">
				{heading.subheadings.map((subheading) => (
					<Astro.self heading={subheading} />
				))}
			</ol>
		)
	}
</li>

<script>
	// Active state based on location.hash
	class TocHeading extends HTMLLIElement {
		constructor() {
			super();

			this.update();
			window.addEventListener("hashchange", () => this.update());
		}

		update() {
			const a = this.querySelector("a");
			if (!a) throw new Error("expected <a> element");

			const href = a.getAttribute("href");

			if (href === location.hash) {
				a.classList.add(
					"!text-primary-400",
					"!border-primary-500/80",
					"bg-primary-500/10"
				);
			} else {
				a.classList.remove(
					"!text-primary-400",
					"!border-primary-500/80",
					"bg-primary-500/10"
				);
			}
		}
	}
	customElements.define("toc-heading", TocHeading, { extends: "li" });
</script>
